<mat-expansion-panel class="panel-group" id="sources" [expanded]="sourcesPanelState" (opened)="sourcesPanelState = true" (closed)="sourcesPanelState = false" *ngIf="sources">
  <mat-expansion-panel-header [collapsedHeight]="expansionPanelHeight" [expandedHeight]="expansionPanelHeight" class="panel-header">
    <mat-panel-title class="panel-title">
      Sources
    </mat-panel-title>
  </mat-expansion-panel-header>


  <div class="helper-text">
    <!-- <i class="fas fa-arrow-down"></i>  -->
    <i class="fas fa-level-up-alt helper-arrow"></i>
    <span class="text">percent of experiments from source</span>
  </div>

  <div *ngFor="let source of sources; let idx=index" class="container dataset-source-container">
    <div class="source-percent" [ngStyle]="{ 'background': colorScale(source.percent), 'color': source.percent > textColorThreshold ? 'white' : '#212529' }">
      {{ source.percent | percent : 0 }}
    </div>


    <ng-container [ngTemplateOutlet]="idx < source.length / 2 ? leftData : rightData" [ngTemplateOutletContext]="{ source: source }"></ng-container>


    <ng-template #leftData let-source="source">
      <div class="left-container">
        <ng-container [ngTemplateOutlet]="sourceData" [ngTemplateOutletContext]="{ source: source}"></ng-container>
      </div>
    </ng-template>

    <ng-template #rightData let-source="source">
      <div class="left-container">
        <ng-container [ngTemplateOutlet]="sourceData" [ngTemplateOutletContext]="{ source: source}"></ng-container>
      </div>
    </ng-template>

    <ng-template #sourceData let-source="source">
      <div [ngSwitch]="source.type" class="source">
        <app-format-citation [citations]="[source]" class="citation-group" *ngSwitchCase="'citation'"></app-format-citation>
        <app-format-publisher [publisher]="source" class="publisher-group" *ngSwitchCase="'publisher'"></app-format-publisher>
        <app-format-publisher [publisher]="source" class="unknown-group" *ngSwitchCase="'unknown'"></app-format-publisher>
        <app-format-publisher [publisher]="source" class="unknown-group" *ngSwithDefault></app-format-publisher>
      </div>
    </ng-template>

  </div>

</mat-expansion-panel>

<!-- <h2>How to cite</h2>
<app-citation></app-citation> -->
