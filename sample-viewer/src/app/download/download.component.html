<h1>Download data</h1>

<form [formGroup]="filterForm">
  <div *ngFor="let key of filterKeys">
    <h1>{{key}}</h1>
    <div [formArrayName]="key">
      <div *ngFor="let option of filterForm.get(key)['controls']; let i = index">
        <div [formGroupName]="i">
          <mat-checkbox color="primary" [formControl]="option.get('selected')" class="mr-3">
            {{option.get("term").value}} ({{option.get("count").value}})
          </mat-checkbox>
        </div>
      </div>
    </div>
  </div>

</form>


<div class="container align-items-center mb-4">
  <form [formGroup]="whichDataForm" class="container">
    <mat-checkbox color="primary" formControlName="experiment" class="mr-3">
      include experimental data
    </mat-checkbox>
    <mat-checkbox color="primary" formControlName="patient" class="mr-3">
      include patient metadata
    </mat-checkbox>
  </form>

  <button mat-raised-button color="primary" (click)="downloadData()">Download</button>
</div>

<p *ngIf="total || total === 0">
  <b>{{total}}</b> experiments selected
</p>

<div class="container w-100" id="filtered-summary" *ngIf="summary">
  <div id="cohort-count">
    <h4 class="filter-label">cohort</h4>
    <app-mini-donut [data]="summary['cohorts']" [height]="65" [margin]="{ top: 2, bottom: 2, left: 2, right: 135 }" [filterable]="false"></app-mini-donut>
  </div>

  <div class="grid-item grid-column-container" id="outcome-count">
    <h4 class="filter-label">outcome</h4>
    <app-mini-barplot [data]="summary['outcomes']" [height]="55" [width]="75" [margin]="{ top: 2, bottom: 2, left: 50, right: 70 }" [filterable]="false"></app-mini-barplot>
  </div>

  <div class="grid-item grid-column-container" id="country-count">
    <h4 class="filter-label">country</h4>
    <div class="grid-row-container">
      <app-choropleth [data]="summary['countries']"></app-choropleth>
      <app-dot-plot [data]="summary['countries']"></app-dot-plot>
    </div>
  </div>

  <div class="grid-item grid-column-container" id="outcome-count">
    <h4 class="filter-label">host</h4>
    <app-mini-barplot [data]="summary['species']" [height]="55" [width]="75" [margin]="{ top: 2, bottom: 2, left: 50, right: 170 }" [filterable]="false"></app-mini-barplot>
  </div>

  <div class="grid-item grid-row-container" id="year-file-count">
    <div id="year-count" class="grid-column-container">
      <h4 class="filter-label">year</h4>
      <app-filterable-histogram [data]="summary['years']" [xDomain]="[1979, 2020]" [filterable]="false" [height]="40" [width]="110" [min_width_unknown]="0" [unknown]="false" [numXTicks]="3" [filter_title]="'uniqueid'"></app-filterable-histogram>
    </div>
  </div>
</div>

<div class="container w-100">
  <h6>Filters</h6>
  <div>
    Table
    <table>

    </table>
  </div>
</div>
